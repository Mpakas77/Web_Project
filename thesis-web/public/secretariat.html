<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <title>Πίνακας Γραμματείας</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body class="secretariat">
  <header class="topbar">
    <h2 style="margin:0">Πίνακας Γραμματείας</h2>
    <button id="logoutBtn" class="btn">Αποσύνδεση</button>
  </header>

  <main class="container">
    <nav class="tabs">
      <button type="button" data-tab="view"    id="tab-view" class="active">1) Προβολή ΔΕ</button>
      <button type="button" data-tab="import"  id="tab-import">2) Εισαγωγή δεδομένων</button>
      <button type="button" data-tab="manage"  id="tab-manage">3) Διαχείριση διπλωματικής</button>
    </nav>

    <section id="pane-view" class="card">
      <div class="row" style="align-items:center">
        <div><strong>Φίλτρο:</strong> <span class="muted">Ενεργή & Υπό εξέταση</span></div>
        <div style="text-align:right"><button id="btnReload" class="btn btn-sm">Ανανέωση</button></div>
      </div>
      <div id="thesesList" class="card inset">Φόρτωση…</div>
    </section>

    <section id="pane-import" class="card" hidden>
      <h3>Εισαγωγή χρηστών (JSON)</h3>
      <p class="muted" style="margin:.25rem 0">
        Αναμένει πίνακα αντικειμένων με πεδία <code>role</code> (student|teacher), <code>student_number</code>, <code>name</code>, <code>email</code>.
      </p>
      <pre class="card inset" style="overflow:auto;white-space:pre-wrap">
[
  {"role":"student","student_number":"s1234","name":"Γιάννης Παπαδόπουλος","email":"s1234@uni.gr"},
  {"role":"teacher","name":"Καθηγητής Α. Αλφα","email":"a.alpha@uni.gr"}
]
      </pre>
      <div class="row">
        <label>
          <span>Αρχείο JSON</span>
          <input type="file" id="jsonFile" accept="application/json" />
        </label>
        <div style="align-self:end">
          <button id="btnImport" class="btn">Εισαγωγή</button>
          <span id="importMsg" class="muted" style="margin-left:.5rem"></span>
        </div>
      </div>
    </section>

    <section id="pane-manage" class="card" hidden>
      <h3 style="margin-top:0">Ενέργειες Γραμματείας</h3>
      <label>
        <span>Επιλογή διπλωματικής</span>
        <select id="manageSel"></select>
      </label>

      <div id="manageInfo" class="card inset">Επίλεξε μια διπλωματική…</div>

      <section id="blockActive" class="card inset" hidden>
        <h4 style="margin:.2rem 0">Ενεργή — Καταχώρηση ΑΠ ΓΣ</h4>
        <form id="formGS" class="row">
          <label><span>Αριθμός ΓΣ</span><input name="approval_gs_number" /></label>
          <label><span>Έτος ΓΣ</span><input name="approval_gs_year" type="number" min="2000" /></label>
          <button class="btn" style="align-self:end">Αποθήκευση</button>
          <span id="gsMsg" class="muted" style="align-self:end"></span>
        </form>

        <h4 style="margin:.6rem 0 .2rem">Ακύρωση ανάθεσης</h4>
        <form id="formCancel" class="row">
          <label><span>Αριθμός ΓΣ</span><input name="council_number" /></label>
          <label><span>Έτος ΓΣ</span><input name="council_year" type="number" min="2000" /></label>
          <label style="grid-column:1/-1"><span>Λόγος ακύρωσης</span>
            <input name="reason" placeholder="π.χ. κατόπιν αίτησης Φοιτητή/τριας" />
          </label>
          <button class="btn danger" style="align-self:end">Ακύρωση ανάθεσης</button>
          <span id="cancelMsg" class="muted" style="align-self:end"></span>
        </form>
      </section>

      <section id="blockReview" class="card inset" hidden>
        <h4 style="margin:.2rem 0">Υπό εξέταση — Μετάβαση σε «Περατωμένη»</h4>
        <p class="muted" style="margin:.2rem 0">
          Πρέπει να υπάρχουν 3 βαθμολογήσεις και σύνδεσμος Νημερτής. Αν λείπει κάτι, η βάση θα το απορρίψει.
        </p>
        <button id="btnComplete" class="btn">Ολοκλήρωση ΔΕ</button>
        <span id="completeMsg" class="muted" style="margin-left:.5rem"></span>
      </section>
    </section>
  </main>

  <script type="module">
    import { logout } from './js/auth.js';
    document.getElementById('logoutBtn')?.addEventListener('click', logout);

    const panes = { view:'pane-view', import:'pane-import', manage:'pane-manage' };
    const tabs  = { view:'tab-view',  import:'tab-import',  manage:'tab-manage' };
    function show(name){
      Object.values(panes).forEach(id => document.getElementById(id).hidden = (id !== panes[name]));
      Object.values(tabs).forEach(id => document.getElementById(id).classList.remove('active'));
      document.getElementById(tabs[name]).classList.add('active');
    }
    document.querySelectorAll('[data-tab]').forEach(b=>b.addEventListener('click',()=>show(b.dataset.tab)));
    show('view');
  </script>

  <script type="module" src="./js/secretariat.js"></script>
</body>
</html>
